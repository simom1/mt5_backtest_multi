# MT5 多周期回测 GUI 重构说明

本次重构在不改变功能的前提下，整理了 GUI 相关代码结构，统一了包内导入方式，提取了通用逻辑，提升了可读性与可维护性。

## 主要变更

- 相对导入统一
  - 将包内绝对导入改为相对导入，保证以包形式导入时不再出现 `ModuleNotFoundError`。
  - 涉及文件：
    - `mt5多周期回测/gui_app.py` → `from .main_window import MainWindow`
    - `mt5多周期回测/main_window.py` → `from .config ...`、`from .strategies.pinbar ...`、`from .ui_components ...`、`from .engines.backtester ...`、`from .utils.tools ...`、`from .tuner ...`
    - `mt5多周期回测/strategies/pinbar.py` → `from .base ...`、`from ..utils.tools ...`、`from ..config ...`
    - `mt5多周期回测/engines/backtester.py` → `from ..utils.tools ...`、`from ..strategies.pinbar ...`、`from ..config ...`
    - `mt5多周期回测/tuner.py` → `from .strategies.pinbar ...`
    - `mt5多周期回测/plotting.py` → `from .utils.plotting import *`
    - `mt5多周期回测/tools.py` → `from .utils.tools import *`
    - `mt5多周期回测/strategy.py` → `from .strategies.pinbar import MultiTimeframePinbarStrategy`

- 逻辑拆分与整理（`main_window.py`）
  - 提取方法：
    - `_collect_run_params()`、`_set_run_in_progress()`、`_append_run_summary()`、`_update_run_kpis()`
    - `_collect_tune_params()`、`_set_tune_in_progress()`、`_save_tuning_results()`、`_best_result()`、`_populate_table_from_csv()`
  - 事件处理函数调用上述辅助方法，减少重复代码。

## 运行方式

- 直接运行 GUI
  - 进入项目根目录：`c:\Users\Administrator\PycharmProjects\pythonProject`
  - 执行（PowerShell）：
    ```powershell
    python -m "mt5多周期回测.gui_app"
    ```
  - 或导入后启动：
    ```powershell
    python -c "import sys; sys.path.insert(0, '.'); import mt5多周期回测.gui_app as app; app.main()"
    ```

- CLI（命令行模式）
  - 单次回测：
    ```powershell
    python -m "mt5多周期回测.main" --mode run
    ```
  - 参数优化：
    ```powershell
    python -m "mt5多周期回测.main" --mode tune --grid_sl 15,20,25 --grid_tp 10,15 --grid_mr 5,10
    ```

注意：如果终端对非 ASCII 模块名有转义/编码问题，请使用双引号包裹模块路径（上方示例已包含）。

## 依赖与环境

- 需要安装：`PySide6`、`pandas`、`matplotlib`、`MetaTrader5` 等。
- 本机需安装并登录可用的 MT5 终端。

## 输出

- 调参结果：`mt5多周期回测/outputs/tuning_results.csv`
- 交易记录：策略会按文件名规则保存至 `outputs/` 目录。

## 后续建议

- 增加参数持久化与启动时自动恢复。
- 加入统一日志记录（文件 + 控制台，带日志等级）。
- 为辅助方法补充单元测试。
- 增加多策略选择映射与 CLI 参数 `--strategy`。
